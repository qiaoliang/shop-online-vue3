# 审查故事

当开发者代理将故事标记为“准备审查”时，执行全面的高级开发者代码审查，并能够直接重构和改进代码。

## 先决条件

- 故事状态必须为“审查”
- 开发者已完成所有任务并更新了文件列表
- 所有自动化测试均通过

## 审查流程

1. **阅读完整故事**
   - 审查所有验收标准
   - 理解开发说明和要求
   - 注意开发者的任何完成说明

2. **根据开发说明指南验证实施**
   - 审查“开发说明”部分中提供给开发者的具体技术指南
   - 验证开发者的实施是否遵循开发说明中指定的架构模式
   - 检查文件位置是否与开发说明中的项目结构指南匹配
   - 确认是否正确使用了任何指定的库、框架或技术方法
   - 验证开发说明中提及的安全考虑是否已实施

3. **关注文件列表**
   - 验证列出的所有文件是否实际已创建/修改
   - 检查是否有任何应已更新但缺失的文件
   - 确保文件位置与开发说明中的项目结构指南对齐

4. **高级开发者代码审查**
   - 以高级开发者的眼光审查代码
   - 如果更改形成一个有凝聚力的整体，则一起审查它们
   - 如果更改是独立的，则逐个文件增量审查
   - 重点关注：
     - 代码架构和设计模式
     - 重构机会
     - 代码重复或效率低下
     - 性能优化
     - 安全问题
     - 最佳实践和模式

5. **主动重构**
   - 作为高级开发者，您能够并且应该在需要改进的地方重构代码
   - 重构时：
     - 直接在文件中进行更改
     - 解释您进行更改的**原因**
     - 描述更改如何改进代码的**方式**
     - 确保重构后所有测试仍然通过
     - 如果修改了其他文件，请更新文件列表

6. **标准合规性检查**
   - 验证是否遵守 `docs/coding-standards.md`
   - 检查是否符合 `docs/unified-project-structure.md`
   - 根据 `docs/testing-strategy.md` 验证测试方法
   - 确保遵循故事中提及的所有指南

7. **验收标准验证**
   - 验证每个 AC 是否完全实施
   - 检查是否有任何缺失的功能
   - 验证边缘情况是否已处理

8. **测试覆盖率审查**
   - 确保单元测试覆盖边缘情况
   - 如果关键覆盖率不足，则添加缺失的测试
   - 验证集成测试（如果需要）是否全面
   - 检查测试断言是否有效
   - 查找缺失的测试场景

9. **文档和注释**
   - 验证代码在可能的情况下是否自文档化
   - 如果缺失，则为复杂逻辑添加注释
   - 确保任何 API 更改都已文档化

## 更新故事文件 - 仅限 QA 结果部分

**关键**：您**只被授权**更新故事文件的“QA 结果”部分。**请勿**修改任何其他部分。

审查和任何重构后，将您的结果附加到故事文件的 QA 结果部分：

```markdown
## QA 结果

### 审查日期：[日期]
### 审查人：Quinn（高级开发者 QA）

### 代码质量评估
[实施质量的总体评估]

### 执行的重构
[列出您执行的任何重构及其解释]
- **文件**：[文件名]
  - **更改**：[更改了什么]
  - **原因**：[更改的原因]
  - **方式**：[如何改进代码]

### 合规性检查
- 编码标准：[✓/✗] [任何注释]
- 项目结构：[✓/✗] [任何注释]
- 测试策略：[✓/✗] [任何注释]
- 所有 AC 均已满足：[✓/✗] [任何注释]

### 改进清单
[勾选您自己处理的项目，未勾选的项目留给开发者处理]

- [x] 重构用户服务以更好地处理错误 (services/user.service.ts)
- [x] 添加了缺失的边缘情况测试 (services/user.service.test.ts)
- [ ] 考虑将验证逻辑提取到单独的验证器类中
- [ ] 为错误场景添加集成测试
- [ ] 更新 API 文档以获取新的错误代码

### 安全审查
[发现的任何安全问题以及是否已解决]

### 性能考虑
[发现的任何性能问题以及是否已解决]

### 最终状态
[✓ 批准 - 准备完成] / [✗ 需要更改 - 请参阅上面未勾选的项目]
```

## 关键原则

- 您是审查初级/中级工作的**高级**开发者
- 您有权力和责任直接改进代码
- 始终解释您的更改以供学习
- 在完美与实用之间取得平衡
- 专注于重大改进，而不是吹毛求疵

## 阻塞条件

如果出现以下情况，请停止审查并请求澄清：

- 故事文件不完整或缺少关键部分
- 文件列表为空或明显不完整
- 当需要测试时却不存在测试
- 代码更改与故事要求不符
- 需要讨论的关键架构问题

## 完成

审查后：

1. 如果所有项目都已检查并批准：将故事状态更新为“完成”
2. 如果仍有未检查的项目：将状态保持为“审查”，留给开发者处理
3. 始终提供建设性反馈和解释以供学习
